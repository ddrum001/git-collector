#!/usr/bin/env python3

import csv
import requests
import difflib
from time import sleep
from pprint import pprint

d = difflib.Differ()

new_url = ""
previous_url = ""

prefix = ['---', '+++', '@@']

with open('s1.csv', mode='r') as csv_file:
    csv_reader = csv.DictReader(csv_file)
    line_count = 0
    for row in csv_reader:
        new_url = "https://raw.githubusercontent.com/{0}/{1}/{2}".format(row["repo_name"], row["new_commit_id"], row["new_file_path"])
        previous_url = "https://raw.githubusercontent.com/{0}/{1}/{2}".format(row["repo_name"], row["previous_commit_id"], row["previous_file_path"])
        new_code = requests.get(new_url).text.splitlines(keepends=True)
        previous_code = requests.get(previous_url).text.splitlines(keepends=True)
        for line in difflib.unified_diff(previous_code, new_code, fromfile='previous_code', tofile='new_code', lineterm='', n=0):
            if ( line.startswith('---') or line.startswith('+++') or line.startswith('@@') ):
               break
            else:
               print(line)
        line_count += 1
        sleep(0.5)
    print('Processed {0} lines.'.format(line_count))
